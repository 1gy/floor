import{r as l,j as t,L as B,B as u,m as f,n as S,x as G,u as b,s as F,d as h,y as g,F as P,k as p,z as j,p as U,I as _,S as N,q as J,G as y,g as M,h as R,i as $,o as K,D as H,E as W,H as Y,J as Z,b as X,O as q}from"./vendor.10460ee6.js";import{u as x,a as ee,b as I,c as te,d as se,P as ne,e as re,V as oe,f as ce,g as le}from"./audio.2d9e8c3c.js";import{P as A}from"./Page.31d21bd3.js";import"./index.e94d048a.js";const ie=()=>{const[e,n]=l.exports.useState(()=>new Set),s=l.exports.useCallback(o=>n(a=>new Set([...Array.from(a),o])),[]),r=l.exports.useCallback(o=>n(a=>new Set(Array.from(a).filter(d=>d!==o))),[]),i=l.exports.useCallback(o=>e.has(o),[e]),c=l.exports.useCallback(o=>n(a=>a.has(o)?new Set(Array.from(a).filter(d=>d!==o)):new Set([...Array.from(a),o])),[]);return{set:e,add:s,remove:r,has:i,toggle:c}},v=e=>e.normalize("NFKC").toLowerCase().replace(/[ァ-ン]/g,n=>String.fromCodePoint(n.codePointAt(0)-96)),ae=(e,n)=>{const s=v(e);return v(n.artist).includes(s)||v(n.title).includes(s)},ue=(e,n)=>{const{musics:s}=x(),r=l.exports.useMemo(()=>{if(n.type==null)return s;if(n.type==="contests"){const c=new Set(n.contestIds);return s.filter(o=>c.has(o.contest))}return s.filter(c=>c.contest)},[s,n]);return{filteredMusics:l.exports.useMemo(()=>r.filter(c=>ae(e,c)),[e,r])}},de=({filterText:e,handleClick:n,quizInfo:s})=>{const{filteredMusics:r}=ue(e,s),i=l.exports.useRef(null),c=ee({size:r.length,parentRef:i,estimateSize:l.exports.useCallback(()=>70,[])});return t(B,{ref:i,sx:{width:"100%",height:"100%",overflow:"auto"},children:t(u,{sx:{width:"100%",height:c.totalSize,position:"relative"},children:c.virtualItems.map(o=>t(f,{sx:{position:"absolute",top:0,left:0,width:"100%",height:`${o.size}px`,transform:`translateY(${o.start}px)`},onClick:()=>n(r[o.index].musicId),children:t(S,{secondary:r[o.index].artist,sx:{textOverflow:"ellipsis"},primaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},children:r[o.index].title})},o.key))})})},z=e=>btoa(JSON.stringify(e)),he=e=>JSON.parse(atob(e)),pe=()=>{const[e,n]=I(),[s,r]=te(),{playing:i,play:c,pause:o,canUseVolume:a}=se(e==null?void 0:e.source,s,!0),d=l.exports.useCallback((m,C)=>{typeof C=="number"&&r(C)},[]);return{music:e,playing:i,play:c,pause:o,canUseVolume:a,volume:s,handleVolumeChange:d}},me=(e,n)=>l.exports.useCallback(()=>{const s=c=>e[c]===n.musicIds[c]?"\u2B55":"\u274C";let r=`FLOOR QUIZ
`;r+=`1) ${s(0)}\u30002) ${s(1)}
`,r+=`3) ${s(2)}\u30004) ${s(3)}
`,r+=`5) ${s(4)}\u30006) ${s(5)}
`,r+=`7) ${s(6)}\u30008) ${s(7)}
`,r+=`9) ${s(8)}\u300010) ${s(9)}
`,r+=document.location.href;const i=`https://twitter.com/intent/tweet?text=${encodeURI(r)}`;window.open(i,"_blank")},[e,n]),E=()=>{const e=b();return l.exports.useCallback(()=>{e({to:"/"})},[])},ge=()=>{const[e,n]=I(),{musicTable:s}=x();return l.exports.useCallback(r=>n(s[r]),[])},xe=()=>{const{params:{info:e}}=G(),n=he(e),{musicTable:s}=x(),[r,i]=I(),[c,o]=l.exports.useState(""),a=l.exports.useCallback(w=>{o(w.target.value)},[]),[d,m]=l.exports.useState(0),C=n.musicIds.length,[T,Q]=l.exports.useState([]),V=l.exports.useCallback(w=>{m(k=>k+1),Q(k=>[...k,w])},[]);return l.exports.useEffect(()=>(i(s[n.musicIds[d]]),()=>{}),[d]),{filterText:c,handleFilterChange:a,currentStage:d,lastStage:C,submitAnswer:V,answers:T,quizInfo:n,musicTable:s}},L=()=>{const{music:e,play:n,playing:s,pause:r,canUseVolume:i,volume:c,handleVolumeChange:o}=pe();return e==null?t(P,{}):h(U,{disableGutters:!0,sx:{ml:1,mr:1},variant:"dense",children:[t(_,{sx:{mr:1},onClick:()=>s?r():n(),children:s?t(ne,{}):t(re,{})}),h(N,{width:"100%",spacing:2,direction:"row",alignItems:"center",children:[t(oe,{}),t(J,{min:0,max:1,step:.01,value:c,onChange:o,disabled:!i}),t(ce,{})]})]})},Ce=({answers:e,quizInfo:n,musicTable:s})=>{const r=E(),i=me(e,n),c=ge();return h(u,{height:"100%",display:"flex",flexDirection:"column",children:[h(u,{children:[t(g,{variant:"outlined",sx:{m:1},onClick:r,children:"\u30C8\u30C3\u30D7\u306B\u623B\u308B"}),t(g,{variant:"outlined",sx:{m:1},onClick:i,children:"\u7D50\u679C\u3092tweet\u3059\u308B"})]}),t(u,{children:t(L,{})}),t(u,{flexGrow:"1",bgcolor:"white",overflow:"auto",children:t(B,{children:e.map((o,a)=>h(P,{children:[h(f,{onClick:()=>c(o),children:[h(p,{children:[a+1,"."]}),t(p,{m:1,children:o===n.musicIds[a]?"\u2B55":"\u274C"}),t(S,{children:s[o].title})]}),o!==n.musicIds[a]&&t(f,{onClick:()=>c(n.musicIds[a]),children:h(S,{children:["\u6B63\u89E3\uFF1A",s[n.musicIds[a]].title]})})]}))})})]})},ye=({filterText:e,handleFilterChange:n,currentStage:s,lastStage:r,submitAnswer:i,quizInfo:c})=>{const o=E();return h(u,{height:"100%",bgcolor:"white",display:"flex",flexDirection:"column",children:[h(u,{bgcolor:"grey.100",p:1,display:"flex",alignItems:"center",children:[h(p,{variant:"body1",children:["Q ",s+1," / ",r]}),t(u,{flexGrow:"1"}),t(g,{variant:"outlined",onClick:o,children:"\u30C8\u30C3\u30D7\u306B\u623B\u308B"})]}),t(u,{children:t(u,{bgcolor:"grey.100",p:1,children:t(L,{})})}),t(u,{p:1,children:t(j,{fullWidth:!0,placeholder:"\u30D5\u30A3\u30EB\u30BF\u30FC",value:e,onChange:n})}),t(u,{flexGrow:"1",overflow:"hidden",children:t(de,{filterText:e,handleClick:i,quizInfo:c})})]})},fe=()=>{const{filterText:e,handleFilterChange:n,currentStage:s,lastStage:r,submitAnswer:i,answers:c,quizInfo:o,musicTable:a}=xe(),d=F();return t(A,{sx:{bgcolor:"grey.100"},children:t(u,{display:"flex",height:"100%",justifyContent:"center",alignItems:"center",children:t(u,{width:`${d.breakpoints.values.sm}px`,height:"100%",boxShadow:"0px 0px 8px 0px gray",children:s!==r?t(ye,{filterText:e,handleFilterChange:n,currentStage:s,lastStage:r,submitAnswer:i,quizInfo:o}):t(Ce,{answers:c,quizInfo:o,musicTable:a})})})})},D=(e,n)=>Math.floor(Math.random()*(n-e)+e),be=e=>{const s=new Set;for(;s.size<10;){const r=D(0,e.length);s.add(e[r].musicId)}return{musicIds:Array.from(s)}},we=()=>{const e=b(),{musics:n}=x();return{play:l.exports.useCallback(()=>{const r=z(be(n));e({to:`/play/${r}`})},[n,e])}},ke=()=>{const e=b();return{go:l.exports.useCallback(()=>{e({to:"/contests"})},[e])}},ve=()=>{const{play:e}=we();return t(M,{sx:{width:300},children:t(R,{onClick:e,children:h($,{children:[t(p,{gutterBottom:!0,variant:"h5",component:"div",children:"\u30E9\u30F3\u30C0\u30E0\u9078\u66F2"}),t(p,{variant:"body2",color:"text.secondary",children:"\u30E9\u30F3\u30C0\u30E0\u306B10\u66F2\u3092\u30D7\u30EC\u30A4\u3057\u307E\u3059"})]})})})},Se=()=>{const{go:e}=ke();return t(M,{sx:{width:300},children:t(R,{onClick:e,children:h($,{children:[t(p,{gutterBottom:!0,variant:"h5",component:"div",children:"\u30B3\u30F3\u30C6\u30B9\u30C8\u9078\u66F2"}),t(p,{variant:"body2",color:"text.secondary",children:"\u30B3\u30F3\u30C6\u30B9\u30C8\u3092\u6307\u5B9A\u3057\u3066\u30E9\u30F3\u30C0\u30E0\u306B10\u66F2\u3092\u30D7\u30EC\u30A4\u3057\u307E\u3059"})]})})})},Be=()=>t(A,{children:h(y,{sx:{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},container:!0,direction:"column",children:[t(y,{item:!0,m:2,children:t(p,{variant:"h4",children:"FLOOR\u66F2\u540D\u30AF\u30A4\u30BA"})}),t(y,{item:!0,m:2,children:t(ve,{})}),t(y,{item:!0,m:2,children:t(Se,{})})]})}),O=10,Ie=(e,n)=>{const s=new Set;for(;s.size<O;){const r=D(0,e.length);s.add(e[r].musicId)}return{type:"contests",musicIds:Array.from(s),contestIds:n}},Ae=e=>{const n=b(),{musics:s}=x(),r=l.exports.useMemo(()=>{const o=new Set(e);return s.filter(a=>o.has(a.contest))},[s,e]),i=l.exports.useMemo(()=>O<=r.length,[r]),c=l.exports.useCallback(()=>{const o=z(Ie(r,e));n({to:`/play/${o}`})},[r,e,n]);return{canPlay:i,play:c}},Fe=()=>{const{set:e,has:n,toggle:s,add:r,remove:i}=ie(),{contests:c}=le(),o=l.exports.useCallback(()=>{c.map(m=>r(m.id))},[c,r]),a=l.exports.useCallback(()=>{c.map(m=>i(m.id))},[c,i]),d=l.exports.useMemo(()=>Array.from(e),[e]);return{contests:c,has:n,toggle:s,selectAll:o,unselectAll:a,selectedContests:d}},Pe=({contest:e,onClick:n,selected:s})=>t(K,{disablePadding:!0,children:h(f,{dense:!0,onClick:n,children:[t(H,{children:t(W,{disableRipple:!0,checked:s})}),t(u,{display:"flex",flexDirection:"row",children:t("img",{width:"100%",src:e.banner,draggable:"false",style:{filter:s?"none":"grayscale(1)"}})})]})}),Me=()=>{const{contests:e,has:n,toggle:s,selectAll:r,unselectAll:i,selectedContests:c}=Fe(),{canPlay:o,play:a}=Ae(c);return h(u,{height:"100%",display:"flex",flexDirection:"column",children:[h(u,{bgcolor:"grey.100",p:1,display:"flex",alignItems:"center",children:[t(p,{m:1,variant:"body1",children:"\u30B3\u30F3\u30C6\u30B9\u30C8\u9078\u629E"}),t(u,{flexGrow:"1"}),t(g,{variant:"contained",sx:{m:1},onClick:a,disabled:!o,children:"OK"})]}),h(u,{p:1,children:[t(g,{variant:"outlined",sx:{m:1},onClick:r,children:"\u5168\u9078\u629E"}),t(g,{variant:"outlined",sx:{m:1},onClick:i,children:"\u5168\u89E3\u9664"})]}),t(u,{flexGrow:"1",bgcolor:"white",overflow:"auto",children:t(B,{children:e.map(d=>t(Pe,{contest:d,onClick:()=>s(d.id),selected:n(d.id)},d.id))})})]})},Re=()=>{const e=F();return t(A,{sx:{bgcolor:"grey.100"},children:t(u,{display:"flex",height:"100%",justifyContent:"center",alignItems:"center",children:t(u,{width:`${e.breakpoints.values.sm}px`,height:"100%",boxShadow:"0px 0px 8px 0px gray",children:t(Me,{})})})})},$e=[{path:"/",element:t(Be,{})},{path:"/contests",element:t(Re,{})},{path:"/play/:info",element:t(fe,{})}],Oe=()=>{const e=Y(),n=Z()("");return t(X,{basepath:n,location:e,routes:$e,children:t(q,{})})};export{Oe as QuizRoutes};
